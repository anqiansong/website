<!doctype html>
<html lang="zh" dir="ltr" class="plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Keson RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Keson Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Keson JSON Feed">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?9abfad4f940c0c6d39f35eba19f044b6";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<link rel="icon" href="/img/keson.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(51 139 255)"><title data-rh="true">Keson 的博客</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://keson.cn/img/keson.jpg"><meta data-rh="true" name="twitter:image" content="https://keson.cn/img/keson.jpg"><meta data-rh="true" property="og:url" content="https://keson.cn/go/golang-module"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="keson, anqiansong, go, golang, goctl, go-zero, 后端"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://keson.cn/go/golang-module"><link data-rh="true" rel="alternate" href="https://keson.cn/go/golang-module" hreflang="zh"><link data-rh="true" rel="alternate" href="https://keson.cn/go/golang-module" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.8ab58a7a.css">
<link rel="preload" href="/assets/js/runtime~main.0b6ab77a.js" as="script">
<link rel="preload" href="/assets/js/main.d085ee33.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="Keson" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.webp" alt="Keson" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Keson</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/project">学习</a><a class="navbar__item navbar__link" href="/archive">归档</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">工具</a><ul class="dropdown__menu"><li><a href="https://github.com/anqiansong/github-compare" target="_blank" rel="noopener noreferrer" class="dropdown__link">github-compare<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a class="navbar__item navbar__link" href="/tags">标签</a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row" style="flex-direction:row-reverse"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_uKok margin-bottom--md">近期文章</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/tool/github-compare">GitHub 仓库对比工具 ———— github-compare</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/arch/icyfenix-one">凤凰架构学习笔记——演进中的架构</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/go/grpc-balaner">grpc 源码阅读之 balancer</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/go/grpc-resolver">gRPC 源码阅读及实践之 resolver</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/go/grpc">grpc源码学习笔记(粗浅版)</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div><meta property="og:type" content="article"><meta property="article:published_time" content="2021-03-05T00:00:00.000Z"><meta property="article:author" content="https://github.com/anqiansong"><meta property="article:tag" content="go,module"></div><style data-emotion="css 1dzra2d">.css-1dzra2d{margin-top:0em;margin-bottom:1.5em;border-radius:var(--ifm-pagination-nav-border-radius);margin-top:0;margin-bottom:-2em;}@media (max-width: 570px){.css-1dzra2d .article__details{padding:0;}}.css-1dzra2d article .single-post--date{color:var(--ifm-color-primary);font-size:0.9em;}.css-1dzra2d article >header >h1{font-size:2em;}@media (max-width: 570px){.css-1dzra2d article >header >h1{font-size:1.6em;text-align:center;}}.css-1dzra2d article >header >h2{font-size:2em;margin-bottom:10px!important;}.css-1dzra2d article >header >h2 a{color:var(--ifm-heading-color);}.css-1dzra2d article >header >h2 a:hover{-webkit-text-decoration:none;text-decoration:none;}@media (max-width: 570px){.css-1dzra2d article >header >h2{font-size:1.7em;}}.css-1dzra2d article >header >div>time{color:var(--post-pub-date-color);}.css-1dzra2d article .markdown p,.css-1dzra2d article .markdown ul{font-family:var(--content-font-family);}.css-1dzra2d .blog-list--item{border-radius:12px;background:var(--blog-item-background-color);box-shadow:var(--blog-item-shadow);padding:1em 1em;position:relative;}@media (max-width: 1000px){.css-1dzra2d .blog-list--item{padding-right:1em;}}.css-1dzra2d .testt{position:absolute;font-size:12vw;color:#c8a3ff;}</style><div class="css-1dzra2d e4qwafa0"><div class="row" style="margin:0px"><div class="col col--12 article__details"><article><header><h1 class="blogPostTitle_uMeh" itemprop="headline">为什么看了 N 次 go module, 就是记不住？</h1><div class="margin-vert--md"><time datetime="2021-03-05T00:00:00.000Z" class="blogPostDate_Ocfp">2021-03-05<!-- --> · 预计阅读时间 <!-- -->18<!-- --> 分钟</time><span class="margin-left--sm" style="color:#8c8c8c"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="eye" class="svg-inline--fa fa-eye fa-w-18" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" style="vertical-align:middle;margin-right:0.25rem" color="#c4d3e0"><path fill="currentColor" d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"></path></svg><span style="font-size:0.9rem"></span></span><div class="post__tags-container" style="display:inline-block"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tags" class="svg-inline--fa fa-tags fa-w-20 margin-left--sm margin-right--sm" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" style="vertical-align:middle" color="#c4d3e0"><path fill="currentColor" d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"></path></svg><a class="post__tags margin-right--sm" style="font-size:0.75em;padding:5px" href="/tags/go">go</a><a class="post__tags margin-right--sm" style="font-size:0.75em;padding:5px" href="/tags/module">module</a></div></div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_KNI9"><div class="avatar margin-bottom--sm"><a href="https://github.com/anqiansong" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_xS9F" src="/img/logo.webp" alt="Keson"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/anqiansong" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Keson</span></a></div><small class="avatar__subtitle" itemprop="description">字节跳动开发工程师 /  goctl 维护人</small></div></div></div></div></header><section class="markdown css-2ytvjk e4qwafa1"><p><img loading="lazy" alt="cover" src="/assets/images/go-module-d63b711ba5601ee90429872d7367d73c.png" width="1200" height="300" class="img_E7b_"></p><h1>go module</h1><p>在go1.16版本发布后，go module由原来的默认值 <code>auto</code> 变为 <code>on</code> 了，这意味着后续开发中，go更推荐用go module 模式开发，而不是gopath模式开发了。</p><p>在之前，我也是大多数以go module模式进行golang开发，但至今对其不熟悉，仅仅停留在：<code>别人是这样做的，我跟着做就是了</code> ，这都算不上会使用go module， 更不必说熟悉或者精通了；在此之前，我会存在这些疑问：</p><ul><li>go mod文件中定义的各项内容代表什么；</li><li>除了常见的 <code>require</code> 、偶尔见 <code>replace</code> 关键字外，<code>exclude</code> 、<code>retract</code> （1.16）这些关键字是什么，怎么用；</li><li>go mod文件语法格式是什么，目前除了跟着别人写，好像也不明白其中的语法</li><li><code>github.com/tal-tech/go-zero v1.1.5</code> 、<code>github.com/antlr/antlr4 v0.0.0-20210105212045-464bcbc32de2</code>
、<code>google.golang.org/protobuf v1.25.0 // indirect</code> 等格式分别代表什么，为什么有的还有
<code>// indirect</code> 修饰；</li><li>go.mod下面为什么有一个go.sum，其有什么作用；</li><li>...</li></ul><p>不知道有多少人和我一样，对go module的了解微不足道。</p><p>最近，带着这些疑惑，去学习了官方的参考手册，这些疑惑就引刃而解了。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="project">project<a class="hash-link" href="#project" title="标题的直接链接">​</a></h2><p>在正式进入module介绍前，有必要首先了解一下project和module的关系，相信开发过Android或者Java的同学对module有非常好的理解，通俗的讲，一个project可以有多个module组成，module可以作为独立
的project被别的project作为依赖引用，如下golang工程 <code>demo</code> 中就包含了 <code>foo</code> 和 <code>bar</code> 两个module</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── go.mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── go.mod</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="module介绍">module介绍<a class="hash-link" href="#module介绍" title="标题的直接链接">​</a></h2><p>go module(以下称：module、模块、工程模块)
是golang中已发布版本的package的集合，是Go管理依赖的一种方式，类似Android中的Gradle，Java中的Maven，当然，他们的管理形式肯定是大相径庭，但是目的都是一致的，对依赖进行管理。</p><p>在go.mod中，其包含了main module的module路径、module依赖及其关联信息（版本等），如果一个工程模块需要以
<code>go module mode</code>（module模式）开发，在工程模块的根目录下必须包含 <code>go.mod</code> 文件。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="module-pathmodule路径">module path(module路径)<a class="hash-link" href="#module-pathmodule路径" title="标题的直接链接">​</a></h2><p>module路径是一个工程模块中的名称，在go.mod中以 <code>module</code> 命令声明，其也是工程模块中package import的前缀，我们来看一下 <code>demo/foo</code> 下的module路径：</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> demo/foo/go.mod</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">module github.com/foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go 1.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require github.com/tal-tech/go-zero</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><code>github.com/foo</code> 为main module <code>foo</code> 模块的模块路径，<code>github.com/tal-tech/go-zero</code> 也是module path, 他们也是foo中package
import的前缀，我在foo下的base包下添加了一个 <code>Echo</code> 函数，然后在 <code>main.go</code> 中调用，我们观察一下其package import的前缀</p><p>目录树</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── base.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── go.mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── main.go</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>main.go</p><div class="codeBlockContainer_I0IT language-golang theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-golang codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">package main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;github.com/foo/base&quot; // github.com/foo 为 module path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;fmt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msg := base.Echo(&quot;go-zero&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt.Println(msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>module路径主要作用是描述一个工程模块的作用是什么，在哪里可以找到，因此，module path的组成元素就包含了</p><ul><li>repo 路径</li><li>repo 文件夹</li><li>版本</li></ul><p>其表现形式如: <code>{{.repo_url}}/{{.nameOfDir}}/{{.version}}</code>， 示例：<code>github.com/tal-tech/go-zero/v2</code> ，<code>github.com/tal-tech</code>
明确告知了 <code>repo</code> 的路径，<code>go-zero</code> 即为repo的文件夹，<code>v2</code> 即为版本号 版本一般 <code>v1</code> 一般都默认不写了，只有大于 <code>v1</code> 时则需要用来区分。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="版本号">版本号<a class="hash-link" href="#版本号" title="标题的直接链接">​</a></h2><p>这里的版本号是指go.mod文件中依赖module的版本，这和上文的 <code>{{.version}}</code> 会有关联，如下示例中的 <code>v1.1.5</code> 即为本次所说的module依赖版本号。</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">module github.com/foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go 1.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require github.com/tal-tech/go-zero v1.1.5</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="版本号组成及规则">版本号组成及规则<a class="hash-link" href="#版本号组成及规则" title="标题的直接链接">​</a></h3><p>版本号由 <code>major version</code>（主要版本）、 <code>minor version</code>（次要版本）、 <code>patch version</code>（修订版本）组成；</p><ul><li>major version：指module中内容作了向后不兼容的更改后，则版本会upgrade，在此版本号upgrade时，<code>minor version</code> 和 <code>patch version</code> 要归零；</li><li>minor version：指在新的功能发布(features)或者作了向后兼容的内容变更后，此版本号会upgrade，在此版本号upgrade时，<code>patch version</code> 要归零；</li><li>patch version：指有bug修复或者功能优化时，此版本号可以进行upgrade，在有pre-release发布需求时也可以变更此版本号</li></ul><p>示例：<code>v0.0.0</code>、 <code>v1.2.3</code>、 <code>v1.2.10-pre</code></p><blockquote><p>如果一个版本的 <code>major version</code> 为 <code>0</code> 或者 <code>patch-version</code> 有版本后缀（如:pre），则认为这个版本是不稳定的，如<code>v0.2.0</code>、 <code>v1.5.0-pre</code>、 <code>v1.1.3-beta</code>
更多关于version语义定义可以参考<a href="https://semver.org/spec/v2.0.0.html" target="_blank" rel="noopener noreferrer">《Semantic Versioning 2.0.0》</a></p></blockquote><p>Golang除此之外，还可以用一些标记、分支来代表某一个版本，如：<code>github.com/tal-tech/go-zero 39540e21d249e91f89d96d015a6e3795cfb2be44</code>
、 <code>github.com/tal-tech/go-zero v1.1.6-0.20210303091609-39540e21d249</code>、
<code>github.com/tal-tech/go-zero@master</code></p><p>其中<code>github.com/tal-tech/go-zero v1.1.6-0.20210303091609-39540e21d249</code> 这种版本在golang里面称为 <code>Pseudo-versions</code>
（伪版本），其没有完全遵循上文中的版本规则，伪版本由三个部分组成：</p><ul><li>版本基本前缀（ <code>vX.Y.Z-0</code> 或 <code>vX.0.0</code> ），如 <code>v1.1.6-0</code></li><li>时间戳：即revision的创建时间戳，如 <code>20210303091609</code></li><li>revision标识符，如 <code>39540e21d249</code></li></ul><p>根据基本前缀的不同，伪版本会有三种形式：</p><ul><li><code>vX.0.0-yyyymmddhhmmss-abcdefabcdef</code> ：在没有 <code>release</code> 版本时使用</li><li><code>vX.Y.Z-pre.0.yyyymmddhhmmss-abcdefabcdef</code> ：当基本版本是预发布版本时使用</li><li><code>vX.Y.(Z+1)-0.yyyymmddhhmmss-abcdefabcdef</code> ：当 <code>release</code> 版本类似 <code>vX.Y.Z</code>
时使用，如 <code>github.com/tal-tech/go-zero v1.1.6-0.20210303091609-39540e21d249</code> 的 <code>release</code> 版本为 <code>v1.1.5</code></li></ul><blockquote><p>伪版本不需要手动输入，其会在执行部分go命令获取某一次提交记录版本(revision)的代码作为依赖时，会自动将其转换为伪版本</p><p>上文中的 <code>github.com/tal-tech/go-zero v1.1.6-0.20210303091609-39540e21d249</code> 则是在执行 <code>go get github.com/tal-tech/go-zero 39540e21d249e91f89d96d015a6e3795cfb2be44</code> 后自动转换的结果</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="版本后缀">版本后缀<a class="hash-link" href="#版本后缀" title="标题的直接链接">​</a></h3><p>为了向前兼容，如果 <code>major version</code> 升级到2时，模块路径必须要指定一个版本后缀 <code>v2</code>（其数值保持和版本中的 <code>major version</code> 的值一致），在 <code>major version</code> 小于2时，不允许使用版本后缀。</p><p>我们来看一个例子，我在 <code>demo/foo</code> 模块工程中用到了 <code>miniRedis</code> 这个库，该库的 <code>major version</code> 已经升级到2了，假设我在go.mod中引用如下版本会怎么样？</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">module github.com/foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go 1.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 正确引入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// require github.com/alicebob/miniredis/v2 v2.14.1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 错误引入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require github.com/alicebob/miniredis v2.14.1</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">invalid version: module contains a go.mod file, so major version must be compatible: should be v0 or v1, not v2</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>上面是go mod使用时的场景，我们来看一下当main module的release版本升级到 <code>v2.x.x</code> 时(前提先发一个v1.0.0的版本)，module path没有添加版本后缀，在另一个module去使用它会有什么效果：
示例module <a href="https://github.com/anqiansong/foo" target="_blank" rel="noopener noreferrer">foo</a>
<code>foo</code> 工程目前有release版本</p><ul><li><code>v1.0.0</code></li><li><code>v2.0.1</code></li><li>...</li></ul><p>使用module的工程 <code>bar</code></p><ul><li>未添加版本后缀前</li></ul><p><code>foo</code> 工程目录树</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── echo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── echo.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── go.mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>module path 为 <code>github.com/anqiansong/foo</code></p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">module github.com/anqiansong/foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go 1.16</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>在工程 <code>bar</code> 的go.mod使用 <code>v2.0.0</code> 版本</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">require github.com/anqiansong/foo v2.0.0</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>你会发现报错内容为</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> require github.com/anqiansong/foo: reading https://goproxy.cn/github.com/anqiansong/foo/@v/v2.0.0.info: 404 Not Found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server response: not found: github.com/anqiansong/foo@v2.0.0: invalid version: module contains a go.mod file, so major version must be compatible: should be v0 or v1, not v2</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>如果 <code>require github.com/anqiansong/foo v1.0.0</code> 是可以的。</p><ul><li>添加版本后缀后</li></ul><p><code>foo</code> 工程目录树</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── echo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── echo.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── go.mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>module path 为 <code>github.com/anqiansong/foo/v2</code></p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">module github.com/anqiansong/foo/v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go 1.16</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>在工程 <code>bar</code> 的go.mod使用 <code>v2.0.1</code> 版本</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">require github.com/anqiansong/foo/v2 v2.0.1</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><code>bar</code> 运行正常</p><blockquote><p>如果 <code>major version</code> 升级至 <code>v2</code> 时，如果该版本没有打算向前兼容，且不想把module path添加版本后缀，则可以在build tag时以 <code>+incompatible</code> 结尾即可，
则别的工程引用示例为 <code>require github.com/anqiansong/foo v2.0.0+incompatible</code></p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="如何解析package中的module">如何解析package中的module<a class="hash-link" href="#如何解析package中的module" title="标题的直接链接">​</a></h2><p>Go 命令首先在构建列表中搜索具有包路径前缀的模块。例如，如果导入了包 <code>example.com/a/b</code> ，而模块 <code>example.com/a</code> 位于构建列表中， 则 go 命令将检查 <code>example.com/a</code>
是否包含目录 <code>b</code> 中的包。且该目录中至少包含一个go文件，这样才能被视为 <code>package</code> 。生成约束不应用于此目的。 如果生成列表中只有一个模块提供包，则使用该模块。如果没有模块提供包，或者有两个或多个模块提供包，则 <code>go</code>
命令报告错误。<code>mod=mod</code> 标志指示 <code>go</code> 命令尝试查找提供丢失包的新模块， 并更新 <code>go.mod</code> 和 <code>go.sum</code> 。<code>go get</code> 和 <code>go mod tidy</code> 命令会自动执行此操作。</p><p>当go命令更新或者获取module依赖时，其会检查 <code>GOPROXY</code> 环境变量，<code>GOPROXY</code> 的值是一个逗号分割的url列表，或者是关键字 <code>direct</code> 、 <code>off</code>，</p><ul><li>逗号分割的具体url为代理地址，其会告知 <code>go</code> 命令以此值去发起连接</li><li><code>direct</code>： 指定module依赖通过版本控制系统去获取</li><li><code>off</code>： 表示不尝试连接获取module</li></ul><p>如果 <code>GOPROXY</code> 设置了具体的url，假设 <code>go</code> 命令要寻找一个<code>github.com/tal-tech/go-zero/zrpc</code>的 <code>package</code>，<code>go</code> 命令会并行的去查找一下module</p><ul><li><code>github.com/tal-tech/go-zero/zrpc</code></li><li><code>github.com/tal-tech/go-zero</code></li><li><code>github.com/tal-tech</code></li><li><code>github.com</code></li></ul><p>如果其中有一个或者多个匹配到包含满足 <code>github.com/tal-tech/go-zero/zrpc</code> 的内容，则取最长的 <code>module</code>作为依赖，在找到合适的module和版本后，<code>go</code> 命令会向 <code>go.mod</code>
和 <code>go.sum</code> 文件中填写<code>require</code>， ，如果解析到的 <code>module</code> 不是 main module 主动引入的，则会在 <code>require</code> 的值后面添加 <code>// direct</code>
注释，如果一个都没有匹配到，则报错；如果 <code>GOPROXY</code> 有多个url代理，在前面失败的情况下，会依次 向后面代理执行上面的步骤。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="gomod-文件">go.mod 文件<a class="hash-link" href="#gomod-文件" title="标题的直接链接">​</a></h2><p>一个 <code>module</code>（模块工程）的标识是在其根目录下包含一个编码为 <code>UTF-8</code>、名称为 <code>go.mod</code> 的文本文件，<code>go.mod</code> 文件中的内容是面向<code>行</code>的，每一行包含一个指令，且每行均由一个 <code>关键字</code> 和 <code>参数</code>
组成，就像：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">module github.com/anqiansong/foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go 1.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require github.com/tal-tech/go-zero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require github.com/tal-tech/go-queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replace go.etcd.io/etcd =&gt; go.etcd.io/etcd v0.0.0-20200402134248-51bdeb39e698</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">retract [v1.0.0, v1.0.1]</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>当然，拥有相同关键字的内容可以分离出来，用 <code>关键字</code> + <code>block</code>组成，就像：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">module github.com/anqiansong/foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go 1.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    github.com/tal-tech/go-zero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    github.com/tal-tech/go-queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replace go.etcd.io/etcd =&gt; go.etcd.io/etcd v0.0.0-20200402134248-51bdeb39e698</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">retract [v1.0.0, v1.0.1]</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><code>go.mod</code>是机器可写的，像执行一些命令（如： <code>go get</code> 、 <code>go mod edit</code>）可能会自动更新 <code>go.mod</code>文件。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="module-组成元素">module 组成元素<a class="hash-link" href="#module-组成元素" title="标题的直接链接">​</a></h2><p>在解析 <code>go.mod</code>文件中的内容时，其会被解析为</p><ul><li><code>空白符</code> ： 包含空格(U+0020)、制表符(U+0009)、回车(U+000D)和换行符(U+000A)</li><li><code>注释</code> ：注释仅支持单行注释 <code>//</code></li><li><code>标点</code> ：标点符号有 <code>(</code> 、 <code>)</code> 、 <code>,</code> 、 <code>=&gt;</code></li><li><code>关键字</code> ： <code>go</code> 、 <code>require</code> 、 <code>replace</code> 、 <code>exclude</code> 、 <code>retract</code></li><li><code>标识符</code> ：由非 <code>空白符</code> 组成的字符序列，如 module path、语义版本</li><li><code>字符串</code> ：由英文双引号 <code>&quot;</code> （U+0022）包裹的解释字符串或者有 <code>&lt;</code> （U+0060）包裹的原始字符串。如<code>&quot;github/com/tal-tech/go-zero&quot;</code>、``</li></ul><blockquote><p><code>标识符</code> 和 <code>字符串</code>在 <code>go.mod</code>语法中可以替换</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="module-语法词法">module 语法词法<a class="hash-link" href="#module-语法词法" title="标题的直接链接">​</a></h2><p><code>go.mod</code> 语法是通过<code>Extended Backus-Naur Form</code> (EBNF范式) 定义的，就像</p><div class="codeBlockContainer_I0IT language-BNF theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-BNF codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">GoMod = { Directive } .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Directive = ModuleDirective |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            GoDirective |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RequireDirective |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ExcludeDirective |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ReplaceDirective |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RetractDirective .</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="module-指令"><code>module</code> 指令<a class="hash-link" href="#module-指令" title="标题的直接链接">​</a></h3><p><code>module</code> 关键字定义了main module的module path，在 <code>go.mod</code> 文件中有且只有一个 <code>module</code> 指定。</p><p>语法规则：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ModuleDirective = &quot;module&quot; ( ModulePath | &quot;(&quot; newline ModulePath newline &quot;)&quot; newline .</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>示例：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">module github.com/tal-tech/go-zero</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="go-指令"><code>go</code> 指令<a class="hash-link" href="#go-指令" title="标题的直接链接">​</a></h3><p><code>go</code> 关键字定义了 <code>module</code> 设置预期使用的go语言版本，版本必须是一个有效的go版本（可以理解为符合 <code>version</code> 规则，也可以理解为为Go已经release的版本）</p><p>通过 <code>go</code> 关键字定义版本后，编译器在编译包时就知道应该使用哪个go版本去编译，除此外，<code>go</code> 关键字定义版本还可以用于 是否启用 <code>go</code>命令的一些特性，如是否自动开始vendoring在版本 <code>1.14</code> 及以后。</p><p>语法规则:</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">GoDirective = &quot;go&quot; GoVersion newline .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GoVersion = string | ident .  /* valid release version; see above */</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>示例：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">go 1.16</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="require-指令"><code>require</code> 指令<a class="hash-link" href="#require-指令" title="标题的直接链接">​</a></h3><p><code>require</code> 声明了module依赖的最小版本，在 <code>require</code> 指定版本后，<code>go</code> 相关命令会根据 <a href="https://golang.org/ref/mod#minimal-version-selection" target="_blank" rel="noopener noreferrer">MVS</a>
规则根据此值来加载依赖。</p><p><code>go</code> 寻找依赖时，如果该依赖不是main module直接依赖的，则会在该module path 后面添加 <code>// direct</code> 注释内容。</p><p>语法规则：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">RequireDirective = &quot;require&quot; ( RequireSpec | &quot;(&quot; newline { RequireSpec } &quot;)&quot; newline ) .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RequireSpec = ModulePath Version newline .</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>示例：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">module github.com/tal-tech/go-zero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go 1.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    golang.org/x/crypto v1.4.5 // indirect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    golang.org/x/text v1.6.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="excule-指令"><code>excule</code> 指令<a class="hash-link" href="#excule-指令" title="标题的直接链接">​</a></h3><p><code>excule</code> 会忽略内容中的指定版本，从 <code>go 1.16</code> 后，<code>exclude</code> 指定的module会被忽略， 在 <code>go 1.16</code> 前， 如果 <code>require</code> 的module被 <code>exclude</code>
指定后，会列出并获取更改的为被 <code>exclude</code> 的版本。</p><p>语法规则：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ExcludeDirective = &quot;exclude&quot; ( ExcludeSpec | &quot;(&quot; newline { ExcludeSpec } &quot;)&quot; ) .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExcludeSpec = ModulePath Version newline .</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>示例：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">module github.com/tal-tech/go-zero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go 1.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exclude golang.org/x/net v1.2.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">excule (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    golang.org/x/crypto v1.4.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    golang.org/x/text v1.6.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="replace-指令"><code>replace</code> 指令<a class="hash-link" href="#replace-指令" title="标题的直接链接">​</a></h3><p><code>replace</code> 指令用于将module的指定版本或者module使用其他的module或者版本来替换，如果 <code>=&gt;</code> 左边质指定了版本，则替换 这个版本至目标内容，否则替换替换module的所有版本至目标内容</p><p>语法规则：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ReplaceDirective = &quot;replace&quot; ( ReplaceSpec | &quot;(&quot; newline { ReplaceSpec } &quot;)&quot; newline &quot;)&quot; ) .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ReplaceSpec = ModulePath [ Version ] &quot;=&gt;&quot; FilePath newline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            | ModulePath [ Version ] &quot;=&gt;&quot; ModulePath Version newline .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FilePath = /* platform-specific relative or absolute file path */</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>示例：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">replace golang.org/x/net v1.2.3 =&gt; example.com/fork/net v1.4.5</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><code>=&gt;</code> 右边的内容可以是有效的module path，也可以是相对或者绝对路径，如果是相对或者绝对路径，这该路径的根目录必须包含 <code>go.mod</code> 文件。</p><p>示例：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">require github.com/foo v1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replace github.com/foo v1.0.0 =&gt; ../bar</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="retract-指令116新增"><code>retract</code> 指令(1.16新增)<a class="hash-link" href="#retract-指令116新增" title="标题的直接链接">​</a></h3><p><code>retract</code> 声明的内容，用于标记某些版本或者某个版本范围（闭区间）标记为撤回，一般 <code>retract</code> 声明前需要写一条注释用于说明，当执行 <code>go get</code> 命令时， 如果引用了被标记为 <code>retract</code> 的版本，或者
在 <code>retract</code> 标记的版本范围内，则会提示一条警告（其内容为 <code>retract</code> 的注释内容），通过<code>go list -m -versions</code> 获取版本时也会隐藏该版本。</p><p>语法规则：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">RetractDirective = &quot;retract&quot; ( RetractSpec | &quot;(&quot; newline { RetractSpec } &quot;)&quot; ) .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RetractSpec = ( Version | &quot;[&quot; Version &quot;,&quot; Version &quot;]&quot; ) newline .</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>示例：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">// someting wrong</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">retract v1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// someting wrong in range of versions =&gt; v1.0.0~v1.2.0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">retrace [v1.0.0,v1.2.0]</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>我们来看一个例子，目前 <code>github.com/anqiansong/retract</code> 已经有 <code>v1.0.0</code> 等版本了，我们 添加一行 <code>retract</code> 指令标记
<code>v1.0.0</code> 撤回：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">// someting wrong</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">retract v1.0.0</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>然后release一个版本为 <code>v1.0.1</code> ，接下来在 <code>github.com/anqiansong/bar</code> 中引用 <code>v1.0.0</code>版本</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">require github.com/anqiansong/retract v1.0.0</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>然后执行 <code>go get github.com/anqiansong/retract@v1.0.0</code> ， 不出意外，会得到一个提示包含 <code>something wrong</code> 和 提示更新到 <code>v1.0.1</code> 的信息</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ go get github.com/anqiansong/retract@v1.0.0</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">go: warning: github.com/anqiansong/retract@v1.0.0: retracted by module author: someting wrong</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go: to switch to the latest unretracted version, run:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        go get github.com/anqiansong/retract@latestgo get: downgraded github.com/anqiansong/retract v1.0.1 =&gt; v1.0.0</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>获取 <code>github.com/anqiansong/retract</code> 所有module release版本</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ go list -m -versions github.com/anqiansong/retract</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">github.com/anqiansong/retract v1.0.1</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>部分命令查看 <code>github.com/anqiansong/retract@v1.0.0</code>的结果：</p><ul><li><p><code>go get</code></p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ go get github.com/anqiansong/retract@v1.0.0</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">go: warning: github.com/anqiansong/retract@v1.0.0: retracted by module author: someting wrong</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go: to switch to the latest unretracted version, run:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go get github.com/anqiansong/retract@latest</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p><code>go list -m -u</code></p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ go get github.com/anqiansong/retract@v1.0.0</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">github.com/anqiansong/retract v1.0.0 (retracted) [v1.0.1]</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li><li><p><code>go list -m -versions</code></p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  $ go list -m -versions github.com/anqiansong/retract</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">github.com/anqiansong/retract v1.0.1</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></li></ul><blockquote><p>说明：</p><p><code>retract</code> 控制的是main module的版本，而非依赖的module 版本。</p><p>被 <code>retract</code> 标记的版本其他module还是可以引用的，只是部分 <code>go</code> 命令执行时会有 <code>retract</code> 的不同结果，如上。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="自动更新">自动更新<a class="hash-link" href="#自动更新" title="标题的直接链接">​</a></h2><p>如果 go.mod 缺少信息或者不能准确反映实际情况，大多数 <code>go</code> 命令都会报告错误。<code>go get</code> 、 <code>go mod tidy</code> 命令可以用来修复大多数这类问题。 此外，<code>-mod=mod</code>
标志可以用于大多数模块感知命令(<code>go build</code>、 <code>go test</code> 等) ，以指示 <code>go</code> 命令自动修复 <code>go.mod</code> 和 <code>go.sum</code> 中的问题。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="module-感知">module 感知<a class="hash-link" href="#module-感知" title="标题的直接链接">​</a></h2><p>大多数 go 命令可以在 <code>Module-ware</code> 模式或 <code>GOPATH</code> 模式下运行。在 <code>Module-ware</code> 模式下，go 命令使用 go.mod 文件来查找版本相关性，
它通常从模块缓存中加载包，如果缺少模块，则下载模块。在 <code>GOPATH</code> 模式下，go 命令忽略module； 它在 <code>vendor</code> 或 <code>GOPATH</code> 目录中查找依赖项。</p><p>在 Go 1.16中，无论是否存在 <code>go.mod</code> 文件，<code>Module-ware</code> 模式默认是启用的。在低版本中，当工作目录文件或任何父目录中存在 <code>go.mod</code> 文件时，启用 <code>Module-ware</code> 模式 。</p><p><code>Module-ware</code> 模式可以通过GO111MODULE 环境变量控制，可以设置为 <code>on</code>、<code>off</code> 或 <code>auto</code></p><ul><li><code>off</code> ：<code>go</code> 相关命令会忽略 <code>go.mod</code>文件，然后以 <code>GOPATH</code> 模式运行</li><li><code>on</code> ： <code>on</code> 或者空字符串， 相关命令会 <code>Module-ware</code> 模式运行</li><li><code>auto</code>： 如果当前文件夹存在 <code>go.mod</code> 文件，则会以 <code>Module-ware</code> 模式运行，在 Go 1.15及更低版本，此值为默认值，</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="部分go-module相关命令">部分go module相关命令<a class="hash-link" href="#部分go-module相关命令" title="标题的直接链接">​</a></h2><p>这里命令必须要在 <code>Module-ware</code> 模式才有效</p><table><thead><tr><th>命令</th><th>用法</th><th>备注</th><th>示例</th></tr></thead><tbody><tr><td>go list -m</td><td>go list -m <!-- -->[-u][-retracted]<!-- --> <!-- -->[-versions][list flags]<!-- --> <!-- -->[modules]</td><td>查看module信息</td><td>go list -m all</td></tr><tr><td>go mod init</td><td>go mod init <!-- -->[module-path]</td><td>在工作目录初始化并创建一个go.mod文件</td><td>go mod init demo</td></tr><tr><td>go mod tidy</td><td>go mod tidy <!-- -->[-e][-v]</td><td>整理go.mod文件</td><td>go mode tidy</td></tr><tr><td>go clean -modcache</td><td>go clean <!-- -->[-modcache]</td><td>清除module缓存</td><td>go clean -modcache</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="proxy">Proxy<a class="hash-link" href="#proxy" title="标题的直接链接">​</a></h2><p>模块代理是一个支持 <code>GET</code> 请求响应 的<code>HTTP</code>服务器，该请求没有 <code>query</code> 参数，甚至不需要特定的 <code>header</code> 信息，即使 该值是一个固定的文件系统站点(如：<code>file:// URL</code> )也是可以的。</p><p>模块代理的 <code>HTTP</code> 响应状态码必须包含 <code>200</code>（OK），<code>3xx</code>，<code>4xx</code>、<code>5xx</code>，<code>4xx</code>、<code>5xx</code>被认为是响应错误，<code>404</code> 和 <code>410</code>
表示所有的module请求是不可用的，注意，错误的响应的contentType 应该设置为 <code>text/plain</code>，字符集为 <code>utf-8</code> 或者 <code>us-ascii</code> 。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="urls">URLs<a class="hash-link" href="#urls" title="标题的直接链接">​</a></h3><p><code>go</code> 命令可以通过读取 <code>GOPROXY</code> 环境变量配置来连接连接代理服务器或者版本控制系统，<code>GOPROXY</code> 接受一个逗号(,)或者竖线(|)分割的多个url值， 当以英文逗号(,)
分割时，只有响应状态码为404或者410时就会尝试后面的代理地址，如果是以竖线(|)分割，则在http出现任何错误（包含超时）都会跳过去尝试后面的代理地址。 也可以是 <code>direct</code> 或者 <code>off</code> 关键字。</p><p>下面的表格为一个代理地址必须要实现且有请求响应的path（即一个代理服务器必须要要支持一下路由的实现）</p><ul><li><code>$base</code>为代理服务器地址，如：<a href="https://goproxy.cn" target="_blank" rel="noopener noreferrer">https://goproxy.cn</a></li><li><code>$module</code>为module path，如：github.com/tal-tech/go-zero</li><li><code>$version</code>为module 版本</li><li>在获取module最新版本时， <code>go</code> 相关命令会优先请求 <code>$base/$module/@v/list</code> 地址，如果没有找到适合的版本，
则请求 <code>$base/$module/@latest</code> 获取并匹配是否满足，<code>go</code> 相关命令会按照 <code>release</code> 版本、 <code>pre-release</code> 版本、 <code>pseudo</code> 版本排序。</li></ul><p>而 <code>$base/$module/$version.mod</code> 和 <code>$base/$module/$version.zip</code> 地址必须要提供，因为这些信息可以用于和 <code>go.sum</code> 进行数据校验。</p><p>go module下载后的内容一般会存储在 <code>$GOPATH/pkg/mod/cache/download</code> 路径下，包括版本控制系统下载的也是如此。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="direct">direct<a class="hash-link" href="#direct" title="标题的直接链接">​</a></h3><p>如果 <code>GOPROXY</code> 设置了 <code>direct</code> 值，则在执行相关 <code>go</code> 命令时会从版本控制系统(<code>git</code>、<code>svn</code>等)下载module资源，当然还需要另外两个环境
变量 <code>GOPRIVATE</code> 、 <code>GONOPROXY</code> 配合，更多环境变量信息请参考<a href="https://golang.org/ref/mod#environment-variables" target="_blank" rel="noopener noreferrer">这里</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="module文件大小约束">module文件大小约束<a class="hash-link" href="#module文件大小约束" title="标题的直接链接">​</a></h2><p>对模块 <code>zip</code> 文件的内容有许多限制。这些约束确保可以在广泛的平台上安全和一致地提取压缩文件。</p><p>一个模块最多可以达到500MiB（不管是压缩形式还是未压缩形式文件）</p><p><code>go.mod</code>文件要求显示在16MiB以内</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="gosum">go.sum<a class="hash-link" href="#gosum" title="标题的直接链接">​</a></h2><p>在module的根目录下可能有一个名为 <code>go.sum</code>的文件，其是直接依附在go.mod下面的， 当执行 <code>go</code> 相关命令获取module时，
其会检查 <code>zip</code> 文件和 <code>go.sum</code> 中的值是否一致。</p><p><code>go.sum</code> 中的值由一个 <code>module path</code>、<code>version</code> 和一个<code>hash</code>值组成，如：</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">github.com/anqiansong/retract v1.0.1 h1:jxcsUM/6tvxM7p14/XMeZPFbql5KAAZJfFqiHG+YKxA=</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" title="复制" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h1>总结</h1><p>花了3天时间，第一天看英文原文档，第二、三天翻译成中文来验证自己的理解，并写下这篇日志，经过学习，对于go module手册的学习解开了不少疑惑，
至少开篇的几个问题算是解开了，本文也是将手册中的部分内容作了 <code>搬运</code> 结合了自己的一些理解，
以及用真实例子去验证， 其中还有很多内容我并未完全照搬，如果有兴趣的同学，可以参考官方手册，本文部分内容包含个人理解，也是结合google翻译加上
对一些翻译不合理的地方进行人工翻译，肯定存在不合理的地方，如果有理解不一致的，欢迎提出和讨论。</p><h1>最后</h1><p>有收获可以到 <a href="https://github.com/anqiansong/golang-notes/blob/main/go-module.md" target="_blank" rel="noopener noreferrer">github</a> 点个小❤️❤️ 哈。</p><h1>参考文档</h1><ul><li><a href="https://semver.org/spec/v2.0.0.html" target="_blank" rel="noopener noreferrer">《Semantic Versioning 2.0.0》</a></li><li><a href="https://golang.org/ref/mod" target="_blank" rel="noopener noreferrer">《Go Module官方文档》</a></li></ul></section></article><footer class="article__footer padding-top--md"><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">作者:</span> <span class="post-copyright-info"><a>Keson</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">链接:</span> <span class="post-copyright-info"><a href="https://keson.cn/go/golang-module">https://keson.cn/go/golang-module</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">来源:</span> <span class="post-copyright-info"><a href="https://keson.cn">Keson 的博客</a> 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</span></div></div></footer></div></div></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/go/grpc"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">grpc源码学习笔记(粗浅版)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/go/channel-limiter"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">巧妙使用channel实现限流器</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project" class="table-of-contents__link toc-highlight">project</a></li><li><a href="#module介绍" class="table-of-contents__link toc-highlight">module介绍</a></li><li><a href="#module-pathmodule路径" class="table-of-contents__link toc-highlight">module path(module路径)</a></li><li><a href="#版本号" class="table-of-contents__link toc-highlight">版本号</a><ul><li><a href="#版本号组成及规则" class="table-of-contents__link toc-highlight">版本号组成及规则</a></li><li><a href="#版本后缀" class="table-of-contents__link toc-highlight">版本后缀</a></li></ul></li><li><a href="#如何解析package中的module" class="table-of-contents__link toc-highlight">如何解析package中的module</a></li><li><a href="#gomod-文件" class="table-of-contents__link toc-highlight">go.mod 文件</a></li><li><a href="#module-组成元素" class="table-of-contents__link toc-highlight">module 组成元素</a></li><li><a href="#module-语法词法" class="table-of-contents__link toc-highlight">module 语法词法</a><ul><li><a href="#module-指令" class="table-of-contents__link toc-highlight"><code>module</code> 指令</a></li><li><a href="#go-指令" class="table-of-contents__link toc-highlight"><code>go</code> 指令</a></li><li><a href="#require-指令" class="table-of-contents__link toc-highlight"><code>require</code> 指令</a></li><li><a href="#excule-指令" class="table-of-contents__link toc-highlight"><code>excule</code> 指令</a></li><li><a href="#replace-指令" class="table-of-contents__link toc-highlight"><code>replace</code> 指令</a></li><li><a href="#retract-指令116新增" class="table-of-contents__link toc-highlight"><code>retract</code> 指令(1.16新增)</a></li></ul></li><li><a href="#自动更新" class="table-of-contents__link toc-highlight">自动更新</a></li><li><a href="#module-感知" class="table-of-contents__link toc-highlight">module 感知</a></li><li><a href="#部分go-module相关命令" class="table-of-contents__link toc-highlight">部分go module相关命令</a></li><li><a href="#proxy" class="table-of-contents__link toc-highlight">Proxy</a><ul><li><a href="#urls" class="table-of-contents__link toc-highlight">URLs</a></li><li><a href="#direct" class="table-of-contents__link toc-highlight">direct</a></li></ul></li><li><a href="#module文件大小约束" class="table-of-contents__link toc-highlight">module文件大小约束</a></li><li><a href="#gosum" class="table-of-contents__link toc-highlight">go.sum</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">社交媒体</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">首页</a></li><li class="footer__item"><a class="footer__link-item" href="/about">关于我</a></li><li class="footer__item"><a href="https://github.com/anqiansong" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">友情链接</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/anqiansong/github-compare" target="_blank" rel="noopener noreferrer" class="footer__link-item">github-compare</a></li><li class="footer__item"><a href="https://go-zero.dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">go-zero</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p>Copyright © 2022 Keson Built with Docusaurus.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.0b6ab77a.js"></script>
<script src="/assets/js/main.d085ee33.js"></script>
</body>
</html>